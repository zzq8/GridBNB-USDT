# ä»£ç è´¨é‡å·¥å…·ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®ä½¿ç”¨å¤šç§å·¥å…·æ¥ä¿è¯ä»£ç è´¨é‡ã€ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æœ¬æ–‡æ¡£å°†è¯¦ç»†ä»‹ç»å¦‚ä½•å®‰è£…å’Œä½¿ç”¨è¿™äº›å·¥å…·ã€‚

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…å¼€å‘ä¾èµ–

```bash
# ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
# Windows:
.\.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# å®‰è£…æ‰€æœ‰å¼€å‘å·¥å…·
pip install -r requirements-dev.txt
```

### 2. å®‰è£… Pre-commit é’©å­

```bash
# å®‰è£… Git é’©å­ (é¦–æ¬¡ä½¿ç”¨å¿…é¡»æ‰§è¡Œ)
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰æ£€æŸ¥ (å¯é€‰)
pre-commit run --all-files
```

å®‰è£…å®Œæˆå,æ¯æ¬¡ `git commit` æ—¶ä¼šè‡ªåŠ¨è¿è¡Œä»£ç æ£€æŸ¥ã€‚

## ğŸ”§ å·¥å…·ä»‹ç»

### 1. Black - ä»£ç æ ¼å¼åŒ–

**ä½œç”¨**: è‡ªåŠ¨æ ¼å¼åŒ– Python ä»£ç ,ç»Ÿä¸€ä»£ç é£æ ¼ã€‚

**æ‰‹åŠ¨è¿è¡Œ**:
```bash
# æ ¼å¼åŒ–æ‰€æœ‰ Python æ–‡ä»¶
black .

# ä»…æ£€æŸ¥ä¸ä¿®æ”¹
black --check .

# æ ¼å¼åŒ–å•ä¸ªæ–‡ä»¶
black config.py
```

**é…ç½®**: `pyproject.toml` ä¸­çš„ `[tool.black]` éƒ¨åˆ†
- è¡Œé•¿åº¦: 100 å­—ç¬¦
- ç›®æ ‡ç‰ˆæœ¬: Python 3.8+

### 2. isort - å¯¼å…¥æ’åº

**ä½œç”¨**: è‡ªåŠ¨æ’åºå’Œåˆ†ç»„ import è¯­å¥ã€‚

**æ‰‹åŠ¨è¿è¡Œ**:
```bash
# æ’åºæ‰€æœ‰æ–‡ä»¶çš„ import
isort .

# ä»…æ£€æŸ¥ä¸ä¿®æ”¹
isort --check-only .

# æ’åºå•ä¸ªæ–‡ä»¶
isort config.py
```

**é…ç½®**: `pyproject.toml` ä¸­çš„ `[tool.isort]` éƒ¨åˆ†
- ä½¿ç”¨ Black å…¼å®¹æ¨¡å¼
- è¡Œé•¿åº¦: 100 å­—ç¬¦
- å¯¼å…¥åˆ†ç»„: æ ‡å‡†åº“ â†’ ç¬¬ä¸‰æ–¹åº“ â†’ æœ¬åœ°åº“

### 3. Flake8 - ä»£ç è´¨é‡æ£€æŸ¥

**ä½œç”¨**: æ£€æŸ¥ä»£ç é£æ ¼ã€è¯­æ³•é”™è¯¯å’Œä»£ç å¤æ‚åº¦ã€‚

**æ‰‹åŠ¨è¿è¡Œ**:
```bash
# æ£€æŸ¥æ‰€æœ‰ Python æ–‡ä»¶
flake8

# æ£€æŸ¥å•ä¸ªæ–‡ä»¶
flake8 config.py

# æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
flake8 --statistics
```

**é…ç½®**: `.flake8` æ–‡ä»¶
- æœ€å¤§è¡Œé•¿åº¦: 100 å­—ç¬¦
- æœ€å¤§åœˆå¤æ‚åº¦: 15
- æ–‡æ¡£å­—ç¬¦ä¸²é£æ ¼: Google é£æ ¼

**å¸¸è§é”™è¯¯ä»£ç **:
- `E501`: è¡Œå¤ªé•¿ (ç”± Black å¤„ç†,å·²å¿½ç•¥)
- `F401`: å¯¼å…¥ä½†æœªä½¿ç”¨
- `F841`: å®šä¹‰ä½†æœªä½¿ç”¨çš„å˜é‡
- `E302`: å‡½æ•°å®šä¹‰å‰éœ€è¦ 2 ä¸ªç©ºè¡Œ
- `D100-D107`: ç¼ºå°‘æ–‡æ¡£å­—ç¬¦ä¸²

### 4. mypy - é™æ€ç±»å‹æ£€æŸ¥

**ä½œç”¨**: æ£€æŸ¥ Python ç±»å‹æ³¨è§£,æå‰å‘ç°ç±»å‹é”™è¯¯ã€‚

**æ‰‹åŠ¨è¿è¡Œ**:
```bash
# æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶
mypy .

# æ£€æŸ¥å•ä¸ªæ–‡ä»¶
mypy config.py

# æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
mypy --show-error-codes .
```

**é…ç½®**: `pyproject.toml` ä¸­çš„ `[tool.mypy]` éƒ¨åˆ†
- ç›®æ ‡ç‰ˆæœ¬: Python 3.8
- åˆæœŸå®½æ¾é…ç½®,é€æ­¥ä¸¥æ ¼

**å½“å‰æ£€æŸ¥çš„æ–‡ä»¶**:
- `config.py`
- `risk_manager.py`
- `helpers.py`

*æ³¨æ„*: mypy åˆæœŸä»…æ£€æŸ¥éƒ¨åˆ†æ ¸å¿ƒæ–‡ä»¶,é€æ­¥æ‰©å±•åˆ°å…¨éƒ¨ä»£ç ã€‚

### 5. Bandit - å®‰å…¨æ£€æŸ¥

**ä½œç”¨**: æ‰«æä»£ç ä¸­çš„å®‰å…¨æ¼æ´å’Œæ½œåœ¨é£é™©ã€‚

**æ‰‹åŠ¨è¿è¡Œ**:
```bash
# æ‰«ææ‰€æœ‰æ–‡ä»¶
bandit -r .

# ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š
bandit -r . -f html -o bandit_report.html

# å¿½ç•¥æµ‹è¯•æ–‡ä»¶
bandit -r . --exclude tests/
```

**é…ç½®**: `pyproject.toml` ä¸­çš„ Bandit éƒ¨åˆ†

**å¸¸è§å‘Šè­¦**:
- `B201`: Flask debug æ¨¡å¼
- `B301`: Pickle åºåˆ—åŒ–é£é™©
- `B404`: subprocess ä½¿ç”¨
- `B608`: SQL æ³¨å…¥é£é™©

### 6. Pre-commit - è‡ªåŠ¨åŒ–æ£€æŸ¥

**ä½œç”¨**: åœ¨ Git æäº¤å‰è‡ªåŠ¨è¿è¡Œæ‰€æœ‰ä»£ç æ£€æŸ¥ã€‚

**å‘½ä»¤**:
```bash
# å®‰è£…é’©å­ (é¦–æ¬¡å¿…é¡»)
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰æ£€æŸ¥
pre-commit run --all-files

# è·³è¿‡æ£€æŸ¥æäº¤ (ä¸æ¨è)
git commit --no-verify

# æ›´æ–°é’©å­ç‰ˆæœ¬
pre-commit autoupdate
```

**é…ç½®**: `.pre-commit-config.yaml`

**æ£€æŸ¥æµç¨‹**:
1. æ–‡ä»¶æœ«å°¾æ¢è¡Œç¬¦
2. ç§»é™¤å¤šä½™ç©ºç™½
3. æ£€æŸ¥åˆå¹¶å†²çªæ ‡è®°
4. æ£€æŸ¥ YAML/JSON è¯­æ³•
5. æ£€æŸ¥å¤§æ–‡ä»¶ (>500KB)
6. é˜²æ­¢ç›´æ¥æäº¤åˆ° main/master
7. Black ä»£ç æ ¼å¼åŒ–
8. isort å¯¼å…¥æ’åº
9. Flake8 ä»£ç æ£€æŸ¥
10. mypy ç±»å‹æ£€æŸ¥ (ä»…éƒ¨åˆ†æ–‡ä»¶)
11. Bandit å®‰å…¨æ‰«æ
12. Markdown æ–‡ä»¶æ£€æŸ¥
13. YAML æ–‡ä»¶æ ¼å¼åŒ–

## ğŸ“Š æµ‹è¯•å’Œè¦†ç›–ç‡

### Pytest - å•å…ƒæµ‹è¯•

**è¿è¡Œæµ‹è¯•**:
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
pytest tests/test_config.py

# æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
pytest -v

# è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
pytest -m unit          # ä»…å•å…ƒæµ‹è¯•
pytest -m "not slow"    # è·³è¿‡æ…¢é€Ÿæµ‹è¯•
```

### Coverage - ä»£ç è¦†ç›–ç‡

**ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š**:
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov

# ç”Ÿæˆ HTML æŠ¥å‘Š
pytest --cov --cov-report=html

# æŸ¥çœ‹æŠ¥å‘Š
# Windows:
start htmlcov/index.html
# Linux/Mac:
open htmlcov/index.html
```

**é…ç½®**: `pyproject.toml` ä¸­çš„ `[tool.coverage]` éƒ¨åˆ†

## ğŸš€ æ¨èå·¥ä½œæµ

### å¼€å‘æ–°åŠŸèƒ½

```bash
# 1. åˆ›å»ºæ–°åˆ†æ”¯
git checkout -b feature/new-feature

# 2. ç¼–å†™ä»£ç 
vim config.py

# 3. æ ¼å¼åŒ–ä»£ç 
black .
isort .

# 4. è¿è¡Œæ£€æŸ¥
flake8
mypy .

# 5. è¿è¡Œæµ‹è¯•
pytest

# 6. æäº¤ä»£ç  (è‡ªåŠ¨è§¦å‘ pre-commit)
git add .
git commit -m "feat: add new feature"
```

### ä¿®å¤æ£€æŸ¥å¤±è´¥

å¦‚æœ pre-commit æ£€æŸ¥å¤±è´¥:

1. **Black/isort å¤±è´¥**: è¿™äº›å·¥å…·ä¼šè‡ªåŠ¨ä¿®å¤,é‡æ–° `git add` å¹¶æäº¤
2. **Flake8 å¤±è´¥**: æ ¹æ®é”™è¯¯ä¿¡æ¯æ‰‹åŠ¨ä¿®å¤ä»£ç 
3. **mypy å¤±è´¥**: æ·»åŠ ç±»å‹æ³¨è§£æˆ–ä½¿ç”¨ `# type: ignore` æ³¨é‡Š
4. **Bandit å¤±è´¥**: è¯„ä¼°å®‰å…¨é£é™©å¹¶ä¿®å¤æˆ–æ·»åŠ  `# nosec` æ³¨é‡Š

### è·³è¿‡ç‰¹å®šæ£€æŸ¥

åœ¨ç‰¹æ®Šæƒ…å†µä¸‹,å¯ä»¥è·³è¿‡æ£€æŸ¥:

```python
# è·³è¿‡ Flake8 æ£€æŸ¥
print("debug")  # noqa: T001

# è·³è¿‡ Bandit å®‰å…¨æ£€æŸ¥
subprocess.call(cmd, shell=True)  # nosec

# è·³è¿‡ mypy ç±»å‹æ£€æŸ¥
value = some_function()  # type: ignore
```

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### pyproject.toml
- **Black**: ä»£ç æ ¼å¼åŒ–é…ç½®
- **isort**: å¯¼å…¥æ’åºé…ç½®
- **mypy**: ç±»å‹æ£€æŸ¥é…ç½®
- **pytest**: æµ‹è¯•æ¡†æ¶é…ç½®
- **coverage**: è¦†ç›–ç‡é…ç½®

### .flake8
- Flake8 ä»£ç æ£€æŸ¥é…ç½®
- *æ³¨æ„*: Flake8 ä¸æ”¯æŒ `pyproject.toml`

### .pre-commit-config.yaml
- Pre-commit é’©å­é…ç½®
- åŒ…å«æ‰€æœ‰å·¥å…·çš„ç‰ˆæœ¬å’Œå‚æ•°

## ğŸ” å¸¸è§é—®é¢˜

### Q1: Black å’Œ Flake8 å†²çª?
**A**: å·²åœ¨ `.flake8` ä¸­é…ç½®å¿½ç•¥å†²çªçš„é”™è¯¯ä»£ç  (E203, E501, W503)ã€‚

### Q2: mypy æŠ¥å‘Šç¬¬ä¸‰æ–¹åº“ç±»å‹é”™è¯¯?
**A**: åœ¨ `pyproject.toml` ä¸­çš„ `[[tool.mypy.overrides]]` æ·»åŠ  `ignore_missing_imports = true`ã€‚

### Q3: Pre-commit å¤ªæ…¢?
**A**: å¯ä»¥è·³è¿‡æŸäº›é’©å­:
```bash
SKIP=mypy,bandit git commit -m "message"
```

### Q4: å¦‚ä½•ä¸´æ—¶ç¦ç”¨ pre-commit?
**A**: ä½¿ç”¨ `--no-verify` æ ‡å¿—:
```bash
git commit --no-verify -m "message"
```
*æ³¨æ„*: ä¸æ¨èé¢‘ç¹ä½¿ç”¨,å¯èƒ½å¼•å…¥è´¨é‡é—®é¢˜ã€‚

### Q5: å¦‚ä½•ä¸ºç‰¹å®šç›®å½•ç¦ç”¨æ£€æŸ¥?
**A**: åœ¨å„å·¥å…·é…ç½®ä¸­æ·»åŠ  `exclude` è§„åˆ™ã€‚ä¾‹å¦‚:
```toml
# pyproject.toml
[tool.black]
extend-exclude = '''
/(
  | data
  | nginx
)/
'''
```

## ğŸ“š æ‰©å±•é˜…è¯»

- [Black å®˜æ–¹æ–‡æ¡£](https://black.readthedocs.io/)
- [isort å®˜æ–¹æ–‡æ¡£](https://pycqa.github.io/isort/)
- [Flake8 å®˜æ–¹æ–‡æ¡£](https://flake8.pycqa.org/)
- [mypy å®˜æ–¹æ–‡æ¡£](https://mypy.readthedocs.io/)
- [Bandit å®˜æ–¹æ–‡æ¡£](https://bandit.readthedocs.io/)
- [Pre-commit å®˜æ–¹æ–‡æ¡£](https://pre-commit.com/)
- [Pytest å®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

ä¸ºäº†æŒç»­æå‡ä»£ç è´¨é‡,å»ºè®®:

1. âœ… **å·²å®Œæˆ**: é…ç½®æ‰€æœ‰åŸºç¡€å·¥å…·
2. ğŸ“ **è¿›è¡Œä¸­**: ä¸ºæ ¸å¿ƒæ¨¡å—æ·»åŠ ç±»å‹æ³¨è§£
3. ğŸ”œ **è®¡åˆ’**: æ‰©å±• mypy æ£€æŸ¥åˆ°æ›´å¤šæ–‡ä»¶
4. ğŸ”œ **è®¡åˆ’**: æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° 80%+
5. ğŸ”œ **è®¡åˆ’**: æ·»åŠ  CI/CD è‡ªåŠ¨åŒ–æ£€æŸ¥

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä¼šéšç€é¡¹ç›®æ¼”è¿›ä¸æ–­æ›´æ–°ã€‚å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·æäº¤ Issueã€‚
