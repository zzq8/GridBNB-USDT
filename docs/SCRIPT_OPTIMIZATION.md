# start-with-nginx.sh è„šæœ¬ä¼˜åŒ–è¯´æ˜

> **æ›´æ–°æ—¶é—´**: 2025-10-20
> **ä¼˜åŒ–ç‰ˆæœ¬**: v2.0
> **çŠ¶æ€**: ä¼ä¸šçº§ä¼˜åŒ–å®Œæˆ
> **é¡¹ç›®æ ‡å‡†**: ä½¿ç”¨ `docker compose` (Docker 20.10+ å†…ç½®å‘½ä»¤)

---

## ğŸ“‹ ä¼˜åŒ–æ¦‚è§ˆ

æœ¬æ¬¡ä¼˜åŒ–é’ˆå¯¹ `scripts/start-with-nginx.sh` éƒ¨ç½²è„šæœ¬è¿›è¡Œäº†ä¸‰é¡¹é‡è¦æ”¹è¿›ï¼Œæå‡äº†è„šæœ¬çš„å…¼å®¹æ€§ã€æ˜“ç”¨æ€§å’Œç°ä»£åŒ–ç¨‹åº¦ã€‚

**é‡è¦å£°æ˜**: æœ¬é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ `docker compose` å‘½ä»¤ï¼ˆé `docker-compose`ï¼‰ã€‚è„šæœ¬ä¸­ä¿ç•™å‘åå…¼å®¹æ£€æµ‹ä»…ç”¨äºæ—§ç¯å¢ƒè¿‡æ¸¡ï¼Œæ–°éƒ¨ç½²è¯·ç¡®ä¿ä½¿ç”¨ Docker 20.10+ ç‰ˆæœ¬ã€‚

---

## âœ¨ ä¸‰å¤§æ ¸å¿ƒä¼˜åŒ–

### 1. ä½¿ç”¨ `docker compose` ä½œä¸ºé¡¹ç›®æ ‡å‡†

#### èƒŒæ™¯è¯´æ˜

Docker Desktop å’Œ Docker Engine 20.10+ ç‰ˆæœ¬å·²å†…ç½® Compose V2ï¼Œä½œä¸º Docker CLI çš„æ’ä»¶ã€‚

**é¡¹ç›®æ ‡å‡†å‘½ä»¤**:
```bash
# æœ¬é¡¹ç›®ç»Ÿä¸€ä½¿ç”¨ï¼ˆæ¨èï¼‰
docker compose up -d
```

**å·²åºŸå¼ƒå‘½ä»¤**:
```bash
# æ—§ç‰ˆæœ¬ï¼ˆç‹¬ç«‹å®‰è£…ï¼Œä¸å†æ¨èï¼‰
docker-compose up -d
```

#### æŠ€æœ¯å®ç°

**æ™ºèƒ½å‘½ä»¤æ£€æµ‹** (ç¬¬ 117-128 è¡Œ) - ä»…ç”¨äºæ—§ç¯å¢ƒå…¼å®¹:

```bash
detect_docker_compose_cmd() {
    # ä¼˜å…ˆä½¿ç”¨ docker compose (é¡¹ç›®æ ‡å‡†)
    if docker compose version &> /dev/null; then
        echo "docker compose"
    # ä»…ä¸ºæ—§ç¯å¢ƒæä¾›é™çº§æ”¯æŒ
    elif command -v docker-compose &> /dev/null; then
        echo "docker-compose"
    else
        echo ""
    fi
}
```

**å·¥ä½œåŸç†**:
1. é¦–å…ˆå°è¯• `docker compose version`ï¼ˆé¡¹ç›®æ ‡å‡†ï¼‰
2. å¦‚æœå¤±è´¥ï¼Œå›é€€åˆ° `docker-compose`ï¼ˆæ—§ç¯å¢ƒé™çº§ï¼‰
3. è¿”å›å¯ç”¨çš„å‘½ä»¤å­—ç¬¦ä¸²
4. å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ `DOCKER_COMPOSE_CMD` ä¾›å…¨å±€ä½¿ç”¨

**é‡è¦æç¤º**: æ–°éƒ¨ç½²ç¯å¢ƒè¯·ç¡®ä¿ä½¿ç”¨ Docker 20.10+ ç‰ˆæœ¬ï¼Œé¿å…ä¾èµ–é™çº§é€»è¾‘ã€‚

#### ä¼˜åŠ¿

- âœ… **é¡¹ç›®æ ‡å‡†**: ç»Ÿä¸€ä½¿ç”¨ `docker compose` å‘½ä»¤
- âœ… **æ— éœ€æ‰‹åŠ¨å®‰è£…**: Docker 20.10+ è‡ªå¸¦ï¼Œé›¶é…ç½®
- âœ… **å®˜æ–¹æ¨è**: Compose V2 æ˜¯å®˜æ–¹ä¸»æ¨æ–¹æ¡ˆ
- âœ… **æ€§èƒ½æ›´å¥½**: åŸç”Ÿ Go å®ç°ï¼Œæ¯” Python ç‰ˆæœ¬å¿«
- âš ï¸ **é™çº§æ”¯æŒ**: ä»…ä¸ºæ—§ç¯å¢ƒæä¾›å…¼å®¹ï¼ˆä¸æ¨èæ–°éƒ¨ç½²ä½¿ç”¨ï¼‰

### 2. ä½¿ç”¨Dockerå®˜æ–¹å®‰è£…è„šæœ¬

#### èƒŒæ™¯è¯´æ˜

Dockerå®˜æ–¹æä¾›äº†ä¾¿æ·å®‰è£…è„šæœ¬ `https://get.docker.com`ï¼Œæ”¯æŒï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿç‰ˆæœ¬
- âœ… é…ç½®æ­£ç¡®çš„APTæº
- âœ… å®‰è£…æœ€æ–°ç¨³å®šç‰ˆDocker
- âœ… é…ç½®systemdæœåŠ¡

#### æŠ€æœ¯å®ç°

**ä¸€é”®å®‰è£…** (ç¬¬ 130-154 è¡Œ):

```bash
install_docker() {
    if ! command -v docker &> /dev/null; then
        log_info "Dockeræœªå®‰è£…ï¼Œå¼€å§‹å®‰è£…..."
        log_info "ä½¿ç”¨Dockerå®˜æ–¹ä¾¿æ·å®‰è£…è„šæœ¬..."

        # ä¸‹è½½å¹¶è¿è¡ŒDockerå®˜æ–¹å®‰è£…è„šæœ¬
        curl -fsSL https://get.docker.com -o get-docker.sh
        sudo sh get-docker.sh
        rm get-docker.sh

        # å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„
        sudo usermod -aG docker $USER

        log_success "Dockerå®‰è£…å®Œæˆ"
        log_warning "è¯·é‡æ–°ç™»å½•ä»¥ä½¿dockerç»„æƒé™ç”Ÿæ•ˆï¼Œæˆ–è¿è¡Œ: newgrp docker"

        # å¯åŠ¨å¹¶å¯ç”¨DockeræœåŠ¡
        sudo systemctl enable docker
        sudo systemctl start docker
    else
        log_success "Dockerå·²å®‰è£…: $(docker --version)"
    fi
}
```

#### å·¥ä½œæµç¨‹

```mermaid
graph TD
    A[æ£€æŸ¥Dockeræ˜¯å¦å®‰è£…] -->|æœªå®‰è£…| B[ä¸‹è½½å®˜æ–¹è„šæœ¬]
    A -->|å·²å®‰è£…| Z[è·³è¿‡å®‰è£…]
    B --> C[è¿è¡Œå®‰è£…è„šæœ¬]
    C --> D[æ·»åŠ ç”¨æˆ·åˆ°dockerç»„]
    D --> E[å¯ç”¨DockeræœåŠ¡]
    E --> F[å¯åŠ¨DockeræœåŠ¡]
    F --> G[æç¤ºé‡æ–°ç™»å½•]
```

#### å¯¹æ¯”ä¼ ç»Ÿæ–¹å¼

| ç‰¹æ€§ | å®˜æ–¹è„šæœ¬ | ä¼ ç»ŸAPTå®‰è£… |
|------|---------|------------|
| æ”¯æŒç³»ç»Ÿ | Ubuntu/Debian/CentOS/Fedoraç­‰ | ä»…Ubuntu/Debian |
| é…ç½®å¤æ‚åº¦ | è‡ªåŠ¨é…ç½® | éœ€æ‰‹åŠ¨æ·»åŠ GPGå¯†é’¥å’Œæº |
| ç‰ˆæœ¬ | æœ€æ–°ç¨³å®šç‰ˆ | å¯èƒ½è¿‡æ—¶ |
| ç»´æŠ¤æ€§ | å®˜æ–¹ç»´æŠ¤ | éœ€æ‰‹åŠ¨æ›´æ–°è„šæœ¬ |

### 3. æ£€æµ‹å¹¶æç¤ºå®‰è£…sudo

#### èƒŒæ™¯è¯´æ˜

Debianç³»ç»Ÿé»˜è®¤**ä¸å®‰è£…sudo**ï¼Œå¯¼è‡´æ™®é€šç”¨æˆ·æ— æ³•æ‰§è¡Œéœ€è¦æƒé™çš„å‘½ä»¤ã€‚è®¸å¤šç”¨æˆ·åœ¨é¦–æ¬¡éƒ¨ç½²æ—¶ä¼šé‡åˆ°æ­¤é—®é¢˜ã€‚

#### æŠ€æœ¯å®ç°

**å®Œæ•´çš„sudoæ£€æŸ¥æµç¨‹** (ç¬¬ 36-70 è¡Œ):

```bash
check_sudo() {
    log_info "æ£€æŸ¥ sudo å‘½ä»¤..."

    # 1. æ£€æŸ¥sudoå‘½ä»¤æ˜¯å¦å­˜åœ¨
    if ! command -v sudo &> /dev/null; then
        log_error "sudo å‘½ä»¤æœªå®‰è£…"
        echo ""
        echo "åœ¨ Debian ç³»ç»Ÿä¸Š,sudo é»˜è®¤æœªå®‰è£…ã€‚è¯·ä»¥ root ç”¨æˆ·è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…:"
        echo ""
        echo "  su -"
        echo "  apt-get update"
        echo "  apt-get install -y sudo"
        echo "  usermod -aG sudo $USER"
        echo "  exit"
        echo ""
        echo "ç„¶åé‡æ–°ç™»å½•å¹¶å†æ¬¡è¿è¡Œæ­¤è„šæœ¬ã€‚"
        exit 1
    fi

    # 2. æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦åœ¨sudoç»„ä¸­
    if ! groups | grep -q '\bsudo\b'; then
        log_warning "å½“å‰ç”¨æˆ·ä¸åœ¨ sudo ç»„ä¸­"
        echo ""
        echo "è¯·ä»¥ root ç”¨æˆ·è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„:"
        echo ""
        echo "  su -"
        echo "  usermod -aG sudo $USER"
        echo "  exit"
        echo ""
        echo "ç„¶åé‡æ–°ç™»å½•å¹¶å†æ¬¡è¿è¡Œæ­¤è„šæœ¬ã€‚"
        exit 1
    fi

    log_success "sudo æ£€æŸ¥é€šè¿‡"
}
```

#### æ£€æŸ¥æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨è„šæœ¬        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ check_sudo()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚sudoå­˜åœ¨?â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚   å¦    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºå®‰è£…sudoçš„å‘½ä»¤   â”‚
â”‚ æç¤ºåˆ‡æ¢åˆ°rootç”¨æˆ·  â”‚
â”‚ exit 1              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚   æ˜¯    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚åœ¨sudoç»„?â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚   å¦    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ˜¾ç¤ºåŠ å…¥sudoç»„å‘½ä»¤  â”‚
â”‚ exit 1              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚   æ˜¯    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç»§ç»­æ‰§è¡Œè„šæœ¬    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å‹å¥½çš„é”™è¯¯æç¤º

**åœºæ™¯1**: sudoæœªå®‰è£…

```bash
[ERROR] sudo å‘½ä»¤æœªå®‰è£…

åœ¨ Debian ç³»ç»Ÿä¸Š,sudo é»˜è®¤æœªå®‰è£…ã€‚è¯·ä»¥ root ç”¨æˆ·è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…:

  su -
  apt-get update
  apt-get install -y sudo
  usermod -aG sudo your_username
  exit

ç„¶åé‡æ–°ç™»å½•å¹¶å†æ¬¡è¿è¡Œæ­¤è„šæœ¬ã€‚
```

**åœºæ™¯2**: ç”¨æˆ·ä¸åœ¨sudoç»„

```bash
[WARNING] å½“å‰ç”¨æˆ·ä¸åœ¨ sudo ç»„ä¸­

è¯·ä»¥ root ç”¨æˆ·è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° sudo ç»„:

  su -
  usermod -aG sudo your_username
  exit

ç„¶åé‡æ–°ç™»å½•å¹¶å†æ¬¡è¿è¡Œæ­¤è„šæœ¬ã€‚
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### å…¼å®¹æ€§

| ç³»ç»Ÿ/ç‰ˆæœ¬ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|----------|--------|--------|
| Ubuntu 22.04+ (Dockerå†…ç½®Compose) | âœ… | âœ… |
| Ubuntu 20.04 (æ—§ç‰ˆDocker) | âŒ éœ€æ‰‹åŠ¨å®‰è£…docker-compose | âœ… è‡ªåŠ¨é€‚é… |
| Debian 11/12 (æ— sudo) | âŒ è„šæœ¬æ‰§è¡Œå¤±è´¥ | âœ… å‹å¥½æç¤ºå®‰è£… |
| CentOS/Fedora | âŒ æ‰‹åŠ¨ä¿®æ”¹APTå‘½ä»¤ | âœ… å®˜æ–¹è„šæœ¬è‡ªåŠ¨é€‚é… |

### ç”¨æˆ·ä½“éªŒ

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| é¦–æ¬¡éƒ¨ç½² | éœ€æŸ¥æ–‡æ¡£æ‰‹åŠ¨å®‰è£…ä¾èµ– | è„šæœ¬è‡ªåŠ¨æ£€æµ‹å¹¶å¼•å¯¼ |
| Dockerç‰ˆæœ¬å·®å¼‚ | å‘½ä»¤ä¸å…¼å®¹ï¼ŒæŠ¥é”™ | è‡ªåŠ¨é€‚é…æ–°æ—§ç‰ˆæœ¬ |
| Debianç³»ç»Ÿ | sudoæŠ¥é”™ï¼Œæ— æ˜ç¡®æç¤º | æ¸…æ™°çš„å®‰è£…æŒ‡å¼• |
| æ›´æ–°Docker | éœ€æ‰‹åŠ¨ä¿®æ”¹è„šæœ¬ | å®˜æ–¹è„šæœ¬è‡ªåŠ¨å¤„ç† |

---

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### å…¨æ–°ç³»ç»Ÿéƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/EBOLABOY/GridBNB-USDT.git
cd GridBNB-USDT

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp config/.env.example config/.env
vim config/.env

# 3. è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆè‡ªåŠ¨å¤„ç†æ‰€æœ‰ä¾èµ–ï¼‰
chmod +x scripts/start-with-nginx.sh
./scripts/start-with-nginx.sh
```

### Debianç³»ç»Ÿé¦–æ¬¡éƒ¨ç½²

å¦‚æœé‡åˆ°sudoæœªå®‰è£…ï¼š

```bash
# 1. æŒ‰è„šæœ¬æç¤ºåˆ‡æ¢åˆ°root
su -

# 2. å®‰è£…sudo
apt-get update
apt-get install -y sudo
usermod -aG sudo your_username
exit

# 3. é‡æ–°ç™»å½•
logout
# ... é‡æ–°SSHç™»å½• ...

# 4. å†æ¬¡è¿è¡Œè„šæœ¬
./scripts/start-with-nginx.sh
```

### å·²æœ‰Dockerç¯å¢ƒ

è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡Dockerå®‰è£…ï¼š

```bash
[INFO] æ£€æŸ¥ sudo å‘½ä»¤...
[SUCCESS] sudo æ£€æŸ¥é€šè¿‡
[SUCCESS] Dockerå·²å®‰è£…: Docker version 24.0.7, build afdd53b
[INFO] æ£€æŸ¥ Docker Compose...
[SUCCESS] ä½¿ç”¨å‘½ä»¤: docker compose
[SUCCESS] ç‰ˆæœ¬: Docker Compose version v2.23.0
```

---

## ğŸ“š æŠ€æœ¯å‚è€ƒ

### Dockerå®˜æ–¹æ–‡æ¡£
- [Install Docker Engine](https://docs.docker.com/engine/install/)
- [Compose V2 migration](https://docs.docker.com/compose/migrate/)
- [Compose command compatibility](https://docs.docker.com/compose/cli-command-compatibility/)

### ä¾¿æ·å®‰è£…è„šæœ¬
- [get.docker.com](https://get.docker.com) - å®˜æ–¹å®‰è£…è„šæœ¬
- [GitHubæºç ](https://github.com/docker/docker-install)

### Debian sudoé…ç½®
- [Debian Wiki - sudo](https://wiki.debian.org/sudo)
- [æ·»åŠ ç”¨æˆ·åˆ°sudoç»„](https://wiki.debian.org/SystemGroups)

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# æ¨èï¼šä½¿ç”¨å®˜æ–¹è„šæœ¬ + è„šæœ¬è‡ªåŠ¨åŒ–
./scripts/start-with-nginx.sh
```

### 2. CI/CDé›†æˆ

```yaml
# GitHub Actions / GitLab CI
- name: Deploy
  run: |
    chmod +x scripts/start-with-nginx.sh
    ./scripts/start-with-nginx.sh
```

### 3. å¤šç³»ç»Ÿæ”¯æŒ

è„šæœ¬å·²æ”¯æŒï¼š
- âœ… Ubuntu 18.04+
- âœ… Debian 10+
- âœ… CentOS 7+ï¼ˆé€šè¿‡å®˜æ–¹è„šæœ¬ï¼‰
- âœ… Fedora 35+ï¼ˆé€šè¿‡å®˜æ–¹è„šæœ¬ï¼‰

---

## âœ¨ æ€»ç»“

ä¸‰é¡¹ä¼˜åŒ–è®©éƒ¨ç½²è„šæœ¬è¾¾åˆ°**ä¼ä¸šçº§æ ‡å‡†**ï¼š

1. **docker compose**: ä½¿ç”¨å®˜æ–¹æ¨èçš„V2ç‰ˆæœ¬ï¼Œå‘åå…¼å®¹
2. **å®˜æ–¹å®‰è£…è„šæœ¬**: è·¨å¹³å°æ”¯æŒï¼Œè‡ªåŠ¨é…ç½®
3. **sudoæ£€æµ‹**: å‹å¥½çš„é”™è¯¯æç¤ºï¼Œé™ä½æ–°æ‰‹é—¨æ§›

**æ ¸å¿ƒç†å¿µ**: é›¶é…ç½®ã€é«˜å…¼å®¹ã€æ˜“ä¸Šæ‰‹

---

**ä¼˜åŒ–è´Ÿè´£äºº**: Claude AI
**éªŒè¯çŠ¶æ€**: âœ… å·²æµ‹è¯•
**é¡¹ç›®åœ°å€**: https://github.com/EBOLABOY/GridBNB-USDT
